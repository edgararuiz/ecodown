---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

library(fs)

cat_tree <- function(x, ...) {
  t <-  capture.output(dir_tree(x, ... = ...))
  t[[2]] <- paste0(" ", t[[2]])
  cat(purrr::map_chr(t[2:length(t)], ~ paste0(.x, "\n")))  
}

temp_dir <- tempdir()
dir_site <- path(temp_dir, "test_site")
if(dir_exists(path(temp_dir, "mleap"))) dir_delete(path(temp_dir, "mleap"))
if(dir_exists(dir_site)) dir_delete(dir_site)
```

# ecodown

<!-- badges: start -->
[![Codecov test coverage](https://codecov.io/gh/edgararuiz/ecodown/branch/main/graph/badge.svg)](https://app.codecov.io/gh/edgararuiz/ecodown?branch=main)
[![R-CMD-check](https://github.com/edgararuiz/ecodown/workflows/R-CMD-check/badge.svg)](https://github.com/edgararuiz/ecodown/actions)
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![CRAN status](https://www.r-pkg.org/badges/version/ecodown)](https://CRAN.R-project.org/package=ecodown)
<!-- badges: end -->

The goal of `ecodown` is to make it possible for your R package's documentation to
be published in a Quarto site.  

The vision for `ecodown` is that it is used to document a group of related packages
that will be published to a single Quarto site.  

## Installation

You can install the development version of `ecodown` from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("edgararuiz/ecodown")
```

## Using 

In general, there are 4 steps to keep the documents up-to-date in Quarto:

1. [Prepare the documentation for Quarto](#prepare-the-documentation-for-quarto)
1. [Run Quarto locally](#run-quarto-locally)
1. [Run auto-linking](#run-auto-linking)
1. Commit the changes back to the site


```{r}
library(ecodown)
```
 
### Prepare the documentation for Quarto

`package_build_documentation()` is the main function out of `ecodown`. It is 
similar to the `pkgdown`'s `build_site()`.  It will map and copy the README, 
NEWS and vignettes files. It will also parse and convert the **.Rd** files into 
**.Md** files.  

The `quarto_sub_folder` creates a sub-folder in your workspace where the 
documentation is going to be converted and copied to.

```{r, eval = FALSE}
package_clone_and_build("https://github.com/rstudio/mleap")
```

```{r, echo = FALSE}
package_clone_and_build(
  "https://github.com/rstudio/mleap",
  quarto_base_folder = dir_site
)
```

```{r, include = FALSE}
quarto_base_folder <- system.file("testutils/quarto_files", package = "ecodown")
lapply(dir_ls(quarto_base_folder), function(x) file_copy(x, dir_site, overwrite = TRUE))
```

## Run Quarto locally

Use `quarto::quarto_render()` to convert the markdown files into HTML. 

For this example, an 'index.md' and a '_quarto.yml' file to make it possible to 
run Quarto properly.  This particular setup file points Quarto to a **docs** 
sub-folder.

```{r, eval = FALSE}
quarto::quarto_render()
```

```{r, include = FALSE}
quarto::quarto_render(dir_site)
```

This the content of the **docs** sub-folder after the process completes:

```{r, echo = FALSE}
top_lines <- capture.output(cat_tree(path(dir_site, "docs")))[1:14]
resume_cat <- c(top_lines, " ... more files ...")
cat(paste0(resume_cat, collapse = "\n") )
```

## Run auto-linking

Auto-linking here refers to converting written function names in a given HTML
to links to the reference of that function.  It uses the package `downlit` to 
accomplish this.

In the background, `package_build_documentation()` not only builds the documentation
in a format Quarto accepts, but also pre-loads the necessary R `options` so that
`downlit` is aware that your package is inside your Quarto site.  This will enable
`downlit` to link references of your package to your Quarto site, instead of 
creating a generic link. 

Use the `site_autolink_html()` function to perform the auto-link over all of the
Quarto site, or a sub-folder in it.  By default, it looks at the `output-dir` entry
in the _quarto.yml file to find the location of the HTML files created by
Quarto.

```{r, include = FALSE}
site_autolink_html(path(dir_site, "docs"))
```

```{r, eval = FALSE}
site_autolink_html()
```


```{r, echo = FALSE}
site_autolink_html(path(dir_site, "docs"))
```


